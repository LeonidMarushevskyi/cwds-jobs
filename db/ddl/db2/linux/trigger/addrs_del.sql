DROP TRIGGER CWSINT.trg_del_addrs;

CREATE TRIGGER CWSINT.trg_del_addrs
AFTER DELETE ON CWSINT.ADDRS_T
REFERENCING OLD AS OROW
FOR EACH ROW MODE DB2SQL
BEGIN ATOMIC
	MERGE INTO CWSRS1.ADDRS_T adr USING (
		SELECT 
			orow.IDENTIFIER,
			orow.CITY_NM,
			orow.EMRG_TELNO,
			orow.EMRG_EXTNO,
			orow.FRG_ADRT_B,
			orow.GVR_ENTC,
			orow.MSG_TEL_NO,
			orow.MSG_EXT_NO,
			orow.HEADER_ADR,
			orow.PRM_TEL_NO,
			orow.PRM_EXT_NO,
			orow.STATE_C,
			orow.STREET_NM,
			orow.STREET_NO,
			orow.ZIP_NO,
			orow.LST_UPD_ID,
			orow.LST_UPD_TS,
			orow.ADDR_DSC,
			orow.ZIP_SFX_NO,
			orow.POSTDIR_CD,
			orow.PREDIR_CD,
			orow.ST_SFX_C,
			orow.UNT_DSGC,
			orow.UNIT_NO,
			orow.IBMSNAP_OPERATION,
			orow.IBMSNAP_LOGMARKER
		FROM sysibm.sysdummy1
	) X ON (adr.IDENTIFIER = X.IDENTIFIER) 
	WHEN MATCHED THEN UPDATE SET 
		CITY_NM = nrow.CITY_NM,
		EMRG_TELNO = nrow.EMRG_TELNO,
		EMRG_EXTNO = nrow.EMRG_EXTNO,
		FRG_ADRT_B = nrow.FRG_ADRT_B,
		GVR_ENTC = nrow.GVR_ENTC,
		MSG_TEL_NO = nrow.MSG_TEL_NO,
		MSG_EXT_NO = nrow.MSG_EXT_NO,
		HEADER_ADR = nrow.HEADER_ADR,
		PRM_TEL_NO = nrow.PRM_TEL_NO,
		PRM_EXT_NO = nrow.PRM_EXT_NO,
		STATE_C = nrow.STATE_C,
		STREET_NM = nrow.STREET_NM,
		STREET_NO = nrow.STREET_NO,
		ZIP_NO = nrow.ZIP_NO,
		LST_UPD_ID = nrow.LST_UPD_ID,
		LST_UPD_TS = nrow.LST_UPD_TS,
		ADDR_DSC = nrow.ADDR_DSC,
		ZIP_SFX_NO = nrow.ZIP_SFX_NO,
		POSTDIR_CD = nrow.POSTDIR_CD,
		PREDIR_CD = nrow.PREDIR_CD,
		ST_SFX_C = nrow.ST_SFX_C,
		UNT_DSGC = nrow.UNT_DSGC,
		UNIT_NO = nrow.UNIT_NO,
		IBMSNAP_OPERATION = 'D',
		IBMSNAP_LOGMARKER = current timestamp
	WHEN NOT MATCHED THEN INSERT INTO CWSRS1.ADDRS_T (
	    IDENTIFIER,
		CITY_NM,
		EMRG_TELNO,
		EMRG_EXTNO,
		FRG_ADRT_B,
		GVR_ENTC,
		MSG_TEL_NO,
		MSG_EXT_NO,
		HEADER_ADR,
		PRM_TEL_NO,
		PRM_EXT_NO,
		STATE_C,
		STREET_NM,
		STREET_NO,
		ZIP_NO,
		LST_UPD_ID,
		LST_UPD_TS,
		ADDR_DSC,
		ZIP_SFX_NO,
		POSTDIR_CD,
		PREDIR_CD,
		ST_SFX_C,
		UNT_DSGC,
		UNIT_NO,
		IBMSNAP_OPERATION,
		IBMSNAP_LOGMARKER
	) VALUES (
		nrow.IDENTIFIER,
		nrow.CITY_NM,
		nrow.EMRG_TELNO,
		nrow.EMRG_EXTNO,
		nrow.FRG_ADRT_B,
		nrow.GVR_ENTC,
		nrow.MSG_TEL_NO,
		nrow.MSG_EXT_NO,
		nrow.HEADER_ADR,
		nrow.PRM_TEL_NO,
		nrow.PRM_EXT_NO,
		nrow.STATE_C,
		nrow.STREET_NM,
		nrow.STREET_NO,
		nrow.ZIP_NO,
		nrow.LST_UPD_ID,
		nrow.LST_UPD_TS,
		nrow.ADDR_DSC,
		nrow.ZIP_SFX_NO,
		nrow.POSTDIR_CD,
		nrow.PREDIR_CD,
		nrow.ST_SFX_C,
		nrow.UNT_DSGC,
		nrow.UNIT_NO,
		'D',
		current timestamp
	);
END
